const WEEK_DAYS=["Пн","Вт","Ср","Чт","Пт","Сб","Вс"],HOURS={START:0,END:24,STEP:.5},classList={DAY:{primary:"day",highlited:"active"},HOUR:{primary:"hour",free:"free",booked:"booked",start:"hour-start",end:"hour-end"}};function CalendarHour(t){this.value=t,this.isBooked=!1}function Calendar(t,e){this.start=e.START,this.end=e.END,this.data=Array.from({length:t}).map(t=>{const a=[];for(let t=e.START;t<=e.END;t+=e.STEP)a.push(new CalendarHour(t));return a})}function CalendarView(t,e){this.rootHTML=e,this.model=t,this.bindListeners()}CalendarHour.prototype.book=function(){this.isBooked=!0},CalendarHour.prototype.toggle=function(){this.isBooked=!this.isBooked},Calendar.prototype.getData=function(){return this.filterSlots(this.start,this.end)},Calendar.prototype.bookFilteredSlots=function(){this.data.forEach(t=>{t.forEach(t=>{t.value>=this.start&&t.value<=this.end&&t.book()})})},Calendar.prototype.toggleTimeSlot=function(t,e){const a=this.data[t].findIndex(t=>t.value===Math.trunc(e));this.data[t][a].toggle(),this.data[t][a+1].toggle()},Calendar.prototype.bookTimeRange=function(t,e){this.data.forEach(a=>{a.filter(a=>a.value>=t&&a.value<=e).forEach(t=>t.book())})},Calendar.prototype.filterSlots=function(t,e){return this.start=t,this.end=e,this.data.map(a=>{if(t<e)return a.filter(a=>a.value>=t&&a.value<e);const r=a.filter(e=>e.value>=t),o=a.filter(t=>t.value<e);return r.concat(o)})},CalendarView.prototype.bindListeners=function(){this.rootHTML.addEventListener("click",t=>{if(e=t.target,a=classList.HOUR.primary,console.log(e,a),e.classList.contains(a)||e.closest("."+a)){const e=t.target.closest("."+classList.DAY.primary),a=Array.from(e.parentNode.children).findIndex(t=>t===e),r=t.target.getAttribute("data-value")||t.target.querySelector("[data-value]").getAttribute("data-value");calendar.toggleTimeSlot(a,r),this.render()}var e,a})},CalendarView.prototype.render=function(){this.rootHTML.innerHTML="",this.model.getData().map((t,e)=>{const a=document.createElement("div");a.setAttribute("data-day-title",WEEK_DAYS[e]),a.classList.add(classList.DAY.primary);for(let e=0;e<t.length;e++){const r=document.createElement("div");r.classList.add(classList.HOUR.primary),r.classList.add(t[e].isBooked?classList.HOUR.booked:classList.HOUR.free),r.setAttribute("data-value",t[e].value),Math.trunc(t[e].value)===t[e].value?(r.classList.add(classList.HOUR.start),console.log(e)):r.classList.add(classList.HOUR.end),a.appendChild(r)}return a}).forEach(t=>this.rootHTML.appendChild(t))};const calendar=new Calendar(WEEK_DAYS.length,HOURS),view=new CalendarView(calendar,document.getElementById("time-table"));view.render();const form=document.getElementById("booking");form.addEventListener("submit",t=>{t.preventDefault();const e=t.currentTarget.elements,a=e.start.value,r=e.end.value;calendar.filterSlots(parseFloat(a),parseFloat(r)),view.render()});const markButton=document.getElementById("mark-range");markButton.addEventListener("click",t=>{calendar.bookFilteredSlots(),view.render()}),CalendarHour.prototype.free=function(){this.isBooked=!1},Calendar.prototype.bookFilteredClear=function(){this.data.forEach(t=>{t.forEach(t=>{t.value>=this.start&&t.value<=this.end&&t.free()})})};const clearButton=document.getElementById("clear-range");clearButton.addEventListener("click",t=>{calendar.bookFilteredClear(),view.render()});